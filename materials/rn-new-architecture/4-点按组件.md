# Pressable: 点按组件

1. 所有的设计都是“懂”用户的。也得去优化我们负责的 App、页面的体验，还得在技术上搞懂点按组件使用方法和背后的原理，把这种最常用的人机交互体验给做到及格，做到优秀。

## 要简单易用还是功能丰富？

1. 点按组件是设计给你我这样的开发者来使用的，它功能越简单开发者用起来就越简单，它功能越复杂就能满足更多的需求场景。

那是让开发者简单易用好，还是用丰富的功能去满足用户，有没有两全其美之计？

2. React Native 的点按组件经历了三个版本的迭代：

- 第一代 Touchable 组件，解决的核心问题是，提过多种反馈风格。
- 第二代 Button 组件，实质是对 Touchable 组件的封装。在 Android 上是 TouchableNativeFeedback 组件，在 iOS 上是 TouchableOpacity 组件。
- 第三代 Pressable 组件，不再是 Touchable 组件的封装，而是一个全新重构的点按组件，它的反馈效果可由开发者自行配置。

3. Pressable 组件可以实现 Android 平台特有的涟漪效果？

可以，你可以使用 android_ripple 和 android_disableSound 属性进行配置。

4. 目前这三代点按组件是同时存在于 React Native 的官方组件库中的，那开发时我们该怎么选呢？

- 第一代点按组件 Touchable，功能丰富但学习成本太高；
- 第二代点按组件 Button，简单易用但带了默认样式和反馈效果，通用性太差；
- 第三代点按组件 Pressable，同时满足了简单易用和复杂效果可扩展的特性。

**在实现自定义的业务按钮组件时，我更加推荐你使用第三代点按组件 Pressable。而且，Pressable 组件的动态 style 的设计思路，也是非常值得我们学习的。**

## 如何知道是点击，还是长按？

1. 整个点按事件的响应过程是硬件和软件相互配合的过程。 Pressable 组件响应的整体流程，是从触摸屏识别物理手势开始，到系统和框架 Native 部分把物理手势转换为 JavaScript 手势事件，再到框架 JavaScript 部分确定响应手势的组件，最后到 Pressable 组件确定是点击还是长按。

2. 开始响应事件和结束响应事件是两个最基础的手势事件，在 Android、iOS 或者 Web 中都有类似的事件。在 React Native 中它们是：

- onResponderGrant：开始响应事件，用户手指接触屏幕，且该手势被当前组件锁定后触发；
- onResponderRelease：结束响应事件，用户手指离开屏幕时触发。

3. 点击事件 onPress 和长按事件 onLongPress 是互斥的，触发了一个就不会再触发另一个了。

## 为什么支持中途取消？

1. 点按操作手势的可用范围包括盒模型区域、可触发区域 HitRect 和可保留区域 PressRect

2. 盒模型区域

React Native 中的盒模型概念来自于 Web 领域的 W3C 规范，Margin 是天生透明的，并且不可以设置透明度、设置颜色。

3. 点按事件的默认触发区域是盒模型中的哪几部分？答案就是，盒模型中的默认不透明的部分。这些用户看得见的部分，包括 content、padding 和 border 部分。可以看得见才可以点击，这样的设计是非常合理的。

4. 类似的情景，单手把持手机的时候左上角的返回键老点不中，勾选用户同意事项的时候老勾不中，等等。人的手指并不是什么精密仪器，不能保证任何情况下都能正确地点按到指定区域。那这种情况该怎么处理呢？

可以直接修改宽高、边框、内边距的值，通过扩大盒模型的范围，提高点中的成功率。但是，修改盒模型成本较高，它可能会导致原有 UI 布局发生变化。

**更好的方案是，不修改影响布局的盒模型，直接修改可触发区域的范围，提高点中的成功率。**

### 可触发区域 HitReact

1. Pressable 组件有一个可触发区域 HitRect，默认情况下，可触发区域 HitRect 就是盒模型中的不透明的可见区域。你可以通过修改 hitSlop 的值，直接扩大可触发区域。

2. 在老点不中、老勾不中的场景中，你可以在不改变布局的前提下，设置 Pressable 组件的可触发区域 HitSlop，让可点击区域多个 10 像素、20 像素，让用户的更容易点中。

### 可保留区域 PressRect

1. 用户的手势可能会有一定误差。不仅如此，用户的行为本身就很复杂，用户的意愿也可能会在很短的时间内发生改变的。其实，这里也是在回答开头我们提出的最后一个问题，用户行为的复杂性，就导致了我们在设计点按组件需要有更多的思考。

2. 可保留区域 PressRect。点按事件可保留区域的偏移量（Press Retention Offset）默认是 0，也就是说默认情况下可见区域就是可保留区域。你可以通过设置 pressRetentionOffset 属性，来扩大可保留区域 PressRect。

## 要点

1. 在较老版本的手机浏览器中，点击事件存在 350ms 延迟；在微信聊天框中，点击对方的微信头像比点击右上角三个点的更多按钮，打开页面的速度慢一些；双击事件是常见的点按事件之一，Pressable 组件却没有提供；这三个现象涉及到了 Web、Android、iOS 和 React Native 这四个技术领域，但这三个现象其实都指向同一个答案。
