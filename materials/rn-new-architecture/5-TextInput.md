# TextInput

1. 把文本输入组件 TextInput 的细节体验弄好，要更难一些:

- TextInput 组件是自带状态的宿主组件。TextInput 输入框中的文字状态、光标状态、焦点状态在 React Native 的 JavaScript 框架层的框架层有一份，在 Native 的还有一份，有时候业务代码中还有一份。那多份状态到底以谁为主呢？
- TextInput 组件和键盘是联动的，在处理好 TextInput 组件的同时，我们还得关心一下键盘。当然键盘本身是有 Keyboard API 的，但是键盘类型是“普通键盘”还是“纯数字键盘”，或者键盘右下角的按钮文字是“确定”还是“搜索”，都是由 TextInput 组件控制的。

2. 对于非受控组件来说，存储跨域两次 render 的可行方案是 ref。ref 的值不会因为组件刷新而重新声明，它是专门用来存储组件级别的信息的。

3. ref 的场景：

- 存储 setTimeout/setInterval 的 ID；
- 存储和操作宿主组件（在 Web 中是 DOM 元素）；
- 存储其他不会参与 JSX 计算的对象。

4. 我们要操作文本原件，必须得用受控（Controlled）组件。

5. 对于受控组件来说，可以更加自由地控制输入的文本，比如语音输入文字、通过地图定位填写详细地址。这些复杂场景下，用户既可以自由输入文字，也可以引入程序参与进来。而非受控组件只适用于用户自由输入的场景。

6. 异步更新情况下，JavaScript 线程和 UI 主线程是独立运行的，此时即便 JavaScript 线程卡了 1s，主线程依旧可以正常输入文字。但同步更新的情况下，从输入文字到展示文字会有 1s 的延迟， JavaScript 线程有 1s 的阻塞，UI 主线程也会卡死 1s。

**新架构的同步和异步是可选的，如果你担心性能问题，用异步就好了。**

7. 建议就是使用受控组件，并且使用异步的文字改变事件，这也符合大部分人的代码习惯。

### 输入框的焦点

1. 搜索页面只有一个搜索框的场景下 ，autoFocus 是好用的。但当一个页面有多个输入框时，autoFocus 就没法实现焦点的转移了。

### 联动键盘的体验

1. 输入框和键盘是联动的，键盘的很多属性都可以用 TextInput 组件来设置。

2. 一些细节：

- iOS 微信搜索框的键盘右下角按钮有一个“置灰置蓝”的功能；
- 键盘右下角按钮的文案是可以变化的，你可以根据不同的业务场景进行设置。

有两个属性可以设置这些文案，包括 iOS/Android 通用的 returnKeyType 和 Android 独有的 returnKeyLabel。全部的属性你可以查一下文档，我这里只说一下通用属性：

- default：显示的文案是换行；
- done：显示的文案是“完成”，它适合作为最后一个输入框的提示文案；
- go：显示的文案是“前往”，它适合作为浏览器网站输入框或页面跳出的提示文案；
- next：显示的文案是“下一项”，它适合作为转移焦点的提示文案；
- search：显示的文案是“搜索”，它适合作为搜索框的提示文案；
- send：显示的文案是“发送”，它比较适合聊天输入框的提示文案。

- 登录页面的自动填写账号密码功能。虽然现在有了二维码登录，但传统的账号密码登录场景还是非常多的。每次登录的时候，要输入一遍账号密码，就很麻烦了。

无论是 iOS 还是 Android，它们都有系统层面的记住账号密码的功能，帮助用户快速完成账号密码的填写。完成快速填写功能的 TextInput 属性，在 iOS 上叫做 textContentType，在 Android 上叫做 autoComplete。

- 一些键盘的体验细节，比如 keyboardType 可以控制键盘类型，可以让用户更方便地输入电话号码 phone-pad、邮箱地址 email-address 等等。

## 要点

1. iOS 模拟器上，点击 TextInput 元素并没有键盘弹窗，必须使用真机进行测试。iOS 如何在真机上进行打包请参考：[iOS 个人证书真机调试及报错](https://www.jianshu.com/p/f31116a76ea9)

> iOS 模拟器也是可以弹出键盘的，只要把 Hardware -> Keyboard -> Connect HardWare KeyBoard 的勾去掉就可以了。

2. 实现用于填写验证码的输入框组件：

- 隐藏 TextInput
- 使用显示的 TextInput + letterSpacing 控制字间距。
